<launch>
  <arg name="spawn_distributor" default="true"/>
  <arg name="spawn_revolute_controllers" default="false"/>
  <arg name="spawn_steering_controllers" default="true"/>

  <!-- load robot description -->
  <arg name="robot_description_file" default="$(find tuw_iwos_robot_description)/urdf/iwos.xml"/>
  <param name="robot_description" command="$(find xacro)/xacro $(arg robot_description_file)"/>

  <rosparam file="$(find tuw_iwos_ros_control)/config/controllers.yaml"          command="load"/>
  <rosparam file="$(find tuw_iwos_ros_control)/config/hardware_interfaces.yaml"  command="load"/>

  <rosparam param="tuw_trinamic_ros_control/setup" subst_value="True">
    "$(find tuw_iwos_ros_control)/setup/revolute_setup.yaml"
  </rosparam>

  <rosparam param="tuw_dynamixel_ros_control/setup" subst_value="True">
    "$(find tuw_iwos_ros_control)/setup/steering_setup.yaml"
  </rosparam>

  <node name="tuw_iwos_ros_control_node" pkg="tuw_iwos_ros_control" type="tuw_iwos_ros_control_node" output="screen"/>

  <node name="state_controller_spawner"
        pkg="controller_manager"
        type="spawner"
        output="screen"
        args="/IWOS/controller/state_controller"/>

  <group if="$(arg spawn_revolute_controllers)">
    <node name="revolute_controller_spawner"
          pkg="controller_manager"
          type="spawner"
          output="screen"
          args="/IWOS/controller/left_revolute_controller
                /IWOS/controller/right_revolute_controller"/>
  </group>

  <group if="$(arg spawn_steering_controllers)">
    <node name="steering_controller_spawner"
          pkg="controller_manager"
          type="spawner"
          output="screen"
          args="/IWOS/controller/left_steering_controller
                /IWOS/controller/right_steering_controller"/>
  </group>

  <group if="$(arg spawn_distributor)">
    <node name="tuw_iwos_ros_control_distributor_node"
          pkg="tuw_iwos_ros_control_distributor"
          type="tuw_iwos_ros_control_distributor_node"
          output="screen">
      <remap from="/IWOS/controller/left_revolute_controller/command" to="/left_revolute_command"/>
      <remap from="/IWOS/controller/right_revolute_controller/command" to="/right_revolute_command"/>
      <remap from="/IWOS/controller/left_steering_controller/command" to="/left_steering_command"/>
      <remap from="/IWOS/controller/right_steering_controller/command" to="/right_steering_command"/>
    </node>
  </group>

</launch>
